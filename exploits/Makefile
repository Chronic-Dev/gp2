CC=gcc
CFLAGS=-dynamiclib -I../../includes/
DIRS=$(shell find . -type d -d 1)
RM=rm

all:
	@for d in $(DIRS); do \
		cd $$d; \
		echo "Building $$d Payload... "; \
		make -C payload/; \
		echo "[DONE]"; \
		echo "Building $$d... "; \
		$(CC) -mmacosx-version-min=10.5 -isysroot /Developer/SDKs/MacOSX10.5.sdk -o ../$$d.dylib -install_name $$d $(CFLAGS) *.c; \
		echo "[DONE]"; \
	done

clean:
	@$(RM) *.dylib
	@for d in $(DIRS); do \
		cd $$d; \
		make clean -C payload/; \
	done

